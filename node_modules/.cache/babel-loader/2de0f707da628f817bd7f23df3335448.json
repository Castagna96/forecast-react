{"ast":null,"code":"var fs = require('fs');\n\nvar net = require('net');\n\nvar path = require('path');\n\nfs.existsSync = fs.existsSync || path.existsSync;\n\nvar utils = require('./utils');\n\nvar fsWatcher = require('./fsWatcher');\n\nvar async = require('async');\n\nvar watcherName = 'dataWatcher';\nvar geodatadir;\n\nif (typeof global.geodatadir === 'undefined') {\n  geodatadir = path.join(__dirname, '/../data/');\n} else {\n  geodatadir = global.geodatadir;\n}\n\nvar dataFiles = {\n  city: path.join(geodatadir, 'geoip-city.dat'),\n  city6: path.join(geodatadir, 'geoip-city6.dat'),\n  cityNames: path.join(geodatadir, 'geoip-city-names.dat'),\n  country: path.join(geodatadir, 'geoip-country.dat'),\n  country6: path.join(geodatadir, 'geoip-country6.dat')\n};\nvar privateRange4 = [[utils.aton4('10.0.0.0'), utils.aton4('10.255.255.255')], [utils.aton4('172.16.0.0'), utils.aton4('172.31.255.255')], [utils.aton4('192.168.0.0'), utils.aton4('192.168.255.255')]];\nvar conf4 = {\n  firstIP: null,\n  lastIP: null,\n  lastLine: 0,\n  locationBuffer: null,\n  locationRecordSize: 88,\n  mainBuffer: null,\n  recordSize: 24\n};\nvar conf6 = {\n  firstIP: null,\n  lastIP: null,\n  lastLine: 0,\n  mainBuffer: null,\n  recordSize: 48\n}; //copy original configs\n\nvar cache4 = JSON.parse(JSON.stringify(conf4));\nvar cache6 = JSON.parse(JSON.stringify(conf6));\nvar RECORD_SIZE = 10;\nvar RECORD_SIZE6 = 34;\n\nfunction lookup4(ip) {\n  var fline = 0;\n  var floor = cache4.lastIP;\n  var cline = cache4.lastLine;\n  var ceil = cache4.firstIP;\n  var line;\n  var locId;\n  var buffer = cache4.mainBuffer;\n  var locBuffer = cache4.locationBuffer;\n  var privateRange = privateRange4;\n  var recordSize = cache4.recordSize;\n  var locRecordSize = cache4.locationRecordSize;\n  var i;\n  var geodata = {\n    range: '',\n    country: '',\n    region: '',\n    eu: '',\n    timezone: '',\n    city: '',\n    ll: [0, 0]\n  }; // outside IPv4 range\n\n  if (ip > cache4.lastIP || ip < cache4.firstIP) {\n    return null;\n  } // private IP\n\n\n  for (i = 0; i < privateRange.length; i++) {\n    if (ip >= privateRange[i][0] && ip <= privateRange[i][1]) {\n      return null;\n    }\n  }\n\n  do {\n    line = Math.round((cline - fline) / 2) + fline;\n    floor = buffer.readUInt32BE(line * recordSize);\n    ceil = buffer.readUInt32BE(line * recordSize + 4);\n\n    if (floor <= ip && ceil >= ip) {\n      geodata.range = [floor, ceil];\n\n      if (recordSize === RECORD_SIZE) {\n        geodata.country = buffer.toString('utf8', line * recordSize + 8, line * recordSize + 10);\n      } else {\n        locId = buffer.readUInt32BE(line * recordSize + 8);\n        geodata.country = locBuffer.toString('utf8', locId * locRecordSize + 0, locId * locRecordSize + 2).replace(/\\u0000.*/, '');\n        geodata.region = locBuffer.toString('utf8', locId * locRecordSize + 2, locId * locRecordSize + 5).replace(/\\u0000.*/, '');\n        geodata.metro = locBuffer.readInt32BE(locId * locRecordSize + 5);\n        geodata.ll[0] = buffer.readInt32BE(line * recordSize + 12) / 10000; //latitude\n\n        geodata.ll[1] = buffer.readInt32BE(line * recordSize + 16) / 10000; //longitude\n\n        geodata.area = buffer.readUInt32BE(line * recordSize + 20); //longitude\n\n        geodata.eu = locBuffer.toString('utf8', locId * locRecordSize + 9, locId * locRecordSize + 10).replace(/\\u0000.*/, '');\n        geodata.timezone = locBuffer.toString('utf8', locId * locRecordSize + 10, locId * locRecordSize + 42).replace(/\\u0000.*/, '');\n        geodata.city = locBuffer.toString('utf8', locId * locRecordSize + 42, locId * locRecordSize + locRecordSize).replace(/\\u0000.*/, '');\n      }\n\n      return geodata;\n    } else if (fline === cline) {\n      return null;\n    } else if (fline === cline - 1) {\n      if (line === fline) {\n        fline = cline;\n      } else {\n        cline = fline;\n      }\n    } else if (floor > ip) {\n      cline = line;\n    } else if (ceil < ip) {\n      fline = line;\n    }\n  } while (1);\n}\n\nfunction lookup6(ip) {\n  var buffer = cache6.mainBuffer;\n  var recordSize = cache6.recordSize;\n  var locBuffer = cache4.locationBuffer;\n  var locRecordSize = cache4.locationRecordSize;\n  var geodata = {\n    range: '',\n    country: '',\n    region: '',\n    city: '',\n    ll: [0, 0]\n  };\n\n  function readip(line, offset) {\n    var ii = 0;\n    var ip = [];\n\n    for (ii = 0; ii < 2; ii++) {\n      ip.push(buffer.readUInt32BE(line * recordSize + offset * 16 + ii * 4));\n    }\n\n    return ip;\n  }\n\n  cache6.lastIP = readip(cache6.lastLine, 1);\n  cache6.firstIP = readip(0, 0);\n  var fline = 0;\n  var floor = cache6.lastIP;\n  var cline = cache6.lastLine;\n  var ceil = cache6.firstIP;\n  var line;\n  var locId;\n\n  if (utils.cmp6(ip, cache6.lastIP) > 0 || utils.cmp6(ip, cache6.firstIP) < 0) {\n    return null;\n  }\n\n  do {\n    line = Math.round((cline - fline) / 2) + fline;\n    floor = readip(line, 0);\n    ceil = readip(line, 1);\n\n    if (utils.cmp6(floor, ip) <= 0 && utils.cmp6(ceil, ip) >= 0) {\n      if (recordSize === RECORD_SIZE6) {\n        geodata.country = buffer.toString('utf8', line * recordSize + 32, line * recordSize + 34).replace(/\\u0000.*/, '');\n      } else {\n        locId = buffer.readUInt32BE(line * recordSize + 32);\n        geodata.country = locBuffer.toString('utf8', locId * locRecordSize + 0, locId * locRecordSize + 2).replace(/\\u0000.*/, '');\n        geodata.region = locBuffer.toString('utf8', locId * locRecordSize + 2, locId * locRecordSize + 5).replace(/\\u0000.*/, '');\n        geodata.metro = locBuffer.readInt32BE(locId * locRecordSize + 5);\n        geodata.ll[0] = buffer.readInt32BE(line * recordSize + 36) / 10000; //latitude\n\n        geodata.ll[1] = buffer.readInt32BE(line * recordSize + 40) / 10000; //longitude\n\n        geodata.area = buffer.readUInt32BE(line * recordSize + 44); //area\n\n        geodata.eu = locBuffer.toString('utf8', locId * locRecordSize + 9, locId * locRecordSize + 10).replace(/\\u0000.*/, '');\n        geodata.timezone = locBuffer.toString('utf8', locId * locRecordSize + 10, locId * locRecordSize + 42).replace(/\\u0000.*/, '');\n        geodata.city = locBuffer.toString('utf8', locId * locRecordSize + 42, locId * locRecordSize + locRecordSize).replace(/\\u0000.*/, '');\n      } // We do not currently have detailed region/city info for IPv6, but finally have coords\n\n\n      return geodata;\n    } else if (fline === cline) {\n      return null;\n    } else if (fline === cline - 1) {\n      if (line === fline) {\n        fline = cline;\n      } else {\n        cline = fline;\n      }\n    } else if (utils.cmp6(floor, ip) > 0) {\n      cline = line;\n    } else if (utils.cmp6(ceil, ip) < 0) {\n      fline = line;\n    }\n  } while (1);\n}\n\nfunction get4mapped(ip) {\n  var ipv6 = ip.toUpperCase();\n  var v6prefixes = ['0:0:0:0:0:FFFF:', '::FFFF:'];\n\n  for (var i = 0; i < v6prefixes.length; i++) {\n    var v6prefix = v6prefixes[i];\n\n    if (ipv6.indexOf(v6prefix) == 0) {\n      return ipv6.substring(v6prefix.length);\n    }\n  }\n\n  return null;\n}\n\nfunction preload(callback) {\n  var datFile;\n  var datSize;\n  var asyncCache = JSON.parse(JSON.stringify(conf4)); //when the preload function receives a callback, do the task asynchronously\n\n  if (typeof arguments[0] === 'function') {\n    async.series([function (cb) {\n      async.series([function (cb2) {\n        fs.open(dataFiles.cityNames, 'r', function (err, file) {\n          datFile = file;\n          cb2(err);\n        });\n      }, function (cb2) {\n        fs.fstat(datFile, function (err, stats) {\n          datSize = stats.size;\n          asyncCache.locationBuffer = Buffer.alloc(datSize);\n          cb2(err);\n        });\n      }, function (cb2) {\n        fs.read(datFile, asyncCache.locationBuffer, 0, datSize, 0, cb2);\n      }, function (cb2) {\n        fs.close(datFile, cb2);\n      }, function (cb2) {\n        fs.open(dataFiles.city, 'r', function (err, file) {\n          datFile = file;\n          cb2(err);\n        });\n      }, function (cb2) {\n        fs.fstat(datFile, function (err, stats) {\n          datSize = stats.size;\n          cb2(err);\n        });\n      }], function (err) {\n        if (err) {\n          if (err.code !== 'ENOENT' && err.code !== 'EBADF') {\n            throw err;\n          }\n\n          fs.open(dataFiles.country, 'r', function (err, file) {\n            if (err) {\n              cb(err);\n            } else {\n              datFile = file;\n              fs.fstat(datFile, function (err, stats) {\n                datSize = stats.size;\n                asyncCache.recordSize = RECORD_SIZE;\n                cb();\n              });\n            }\n          });\n        } else {\n          cb();\n        }\n      });\n    }, function () {\n      asyncCache.mainBuffer = Buffer.alloc(datSize);\n      async.series([function (cb2) {\n        fs.read(datFile, asyncCache.mainBuffer, 0, datSize, 0, cb2);\n      }, function (cb2) {\n        fs.close(datFile, cb2);\n      }], function (err) {\n        if (err) {//keep old cache\n        } else {\n          asyncCache.lastLine = datSize / asyncCache.recordSize - 1;\n          asyncCache.lastIP = asyncCache.mainBuffer.readUInt32BE(asyncCache.lastLine * asyncCache.recordSize + 4);\n          asyncCache.firstIP = asyncCache.mainBuffer.readUInt32BE(0);\n          cache4 = asyncCache;\n        }\n\n        callback(err);\n      });\n    }]);\n  } else {\n    try {\n      datFile = fs.openSync(dataFiles.cityNames, 'r');\n      datSize = fs.fstatSync(datFile).size;\n\n      if (datSize === 0) {\n        throw {\n          code: 'EMPTY_FILE'\n        };\n      }\n\n      cache4.locationBuffer = Buffer.alloc(datSize);\n      fs.readSync(datFile, cache4.locationBuffer, 0, datSize, 0);\n      fs.closeSync(datFile);\n      datFile = fs.openSync(dataFiles.city, 'r');\n      datSize = fs.fstatSync(datFile).size;\n    } catch (err) {\n      if (err.code !== 'ENOENT' && err.code !== 'EBADF' && err.code !== 'EMPTY_FILE') {\n        throw err;\n      }\n\n      datFile = fs.openSync(dataFiles.country, 'r');\n      datSize = fs.fstatSync(datFile).size;\n      cache4.recordSize = RECORD_SIZE;\n    }\n\n    cache4.mainBuffer = Buffer.alloc(datSize);\n    fs.readSync(datFile, cache4.mainBuffer, 0, datSize, 0);\n    fs.closeSync(datFile);\n    cache4.lastLine = datSize / cache4.recordSize - 1;\n    cache4.lastIP = cache4.mainBuffer.readUInt32BE(cache4.lastLine * cache4.recordSize + 4);\n    cache4.firstIP = cache4.mainBuffer.readUInt32BE(0);\n  }\n}\n\nfunction preload6(callback) {\n  var datFile;\n  var datSize;\n  var asyncCache6 = JSON.parse(JSON.stringify(conf6)); //when the preload function receives a callback, do the task asynchronously\n\n  if (typeof arguments[0] === 'function') {\n    async.series([function (cb) {\n      async.series([function (cb2) {\n        fs.open(dataFiles.city6, 'r', function (err, file) {\n          datFile = file;\n          cb2(err);\n        });\n      }, function (cb2) {\n        fs.fstat(datFile, function (err, stats) {\n          datSize = stats.size;\n          cb2(err);\n        });\n      }], function (err) {\n        if (err) {\n          if (err.code !== 'ENOENT' && err.code !== 'EBADF') {\n            throw err;\n          }\n\n          fs.open(dataFiles.country6, 'r', function (err, file) {\n            if (err) {\n              cb(err);\n            } else {\n              datFile = file;\n              fs.fstat(datFile, function (err, stats) {\n                datSize = stats.size;\n                asyncCache6.recordSize = RECORD_SIZE6;\n                cb();\n              });\n            }\n          });\n        } else {\n          cb();\n        }\n      });\n    }, function () {\n      asyncCache6.mainBuffer = Buffer.alloc(datSize);\n      async.series([function (cb2) {\n        fs.read(datFile, asyncCache6.mainBuffer, 0, datSize, 0, cb2);\n      }, function (cb2) {\n        fs.close(datFile, cb2);\n      }], function (err) {\n        if (err) {//keep old cache\n        } else {\n          asyncCache6.lastLine = datSize / asyncCache6.recordSize - 1;\n          cache6 = asyncCache6;\n        }\n\n        callback(err);\n      });\n    }]);\n  } else {\n    try {\n      datFile = fs.openSync(dataFiles.city6, 'r');\n      datSize = fs.fstatSync(datFile).size;\n\n      if (datSize === 0) {\n        throw {\n          code: 'EMPTY_FILE'\n        };\n      }\n    } catch (err) {\n      if (err.code !== 'ENOENT' && err.code !== 'EBADF' && err.code !== 'EMPTY_FILE') {\n        throw err;\n      }\n\n      datFile = fs.openSync(dataFiles.country6, 'r');\n      datSize = fs.fstatSync(datFile).size;\n      cache6.recordSize = RECORD_SIZE6;\n    }\n\n    cache6.mainBuffer = Buffer.alloc(datSize);\n    fs.readSync(datFile, cache6.mainBuffer, 0, datSize, 0);\n    fs.closeSync(datFile);\n    cache6.lastLine = datSize / cache6.recordSize - 1;\n  }\n}\n\nmodule.exports = {\n  cmp: utils.cmp,\n  lookup: function (ip) {\n    if (!ip) {\n      return null;\n    } else if (typeof ip === 'number') {\n      return lookup4(ip);\n    } else if (net.isIP(ip) === 4) {\n      return lookup4(utils.aton4(ip));\n    } else if (net.isIP(ip) === 6) {\n      var ipv4 = get4mapped(ip);\n\n      if (ipv4) {\n        return lookup4(utils.aton4(ipv4));\n      } else {\n        return lookup6(utils.aton6(ip));\n      }\n    }\n\n    return null;\n  },\n  pretty: function (n) {\n    if (typeof n === 'string') {\n      return n;\n    } else if (typeof n === 'number') {\n      return utils.ntoa4(n);\n    } else if (n instanceof Array) {\n      return utils.ntoa6(n);\n    }\n\n    return n;\n  },\n  // Start watching for data updates. The watcher waits one minute for file transfer to \n  // completete before triggering the callback.\n  startWatchingDataUpdate: function (callback) {\n    fsWatcher.makeFsWatchFilter(watcherName, geodatadir, 60 * 1000, function () {\n      //Reload data\n      async.series([function (cb) {\n        preload(cb);\n      }, function (cb) {\n        preload6(cb);\n      }], callback);\n    });\n  },\n  // Stop watching for data updates.\n  stopWatchingDataUpdate: function () {\n    fsWatcher.stopWatching(watcherName);\n  },\n  //clear data\n  clear: function () {\n    cache4 = JSON.parse(JSON.stringify(conf4));\n    cache6 = JSON.parse(JSON.stringify(conf6));\n  },\n  // Reload data synchronously\n  reloadDataSync: function () {\n    preload();\n    preload6();\n  },\n  // Reload data asynchronously\n  reloadData: function (callback) {\n    //Reload data\n    async.series([function (cb) {\n      preload(cb);\n    }, function (cb) {\n      preload6(cb);\n    }], callback);\n  }\n};\npreload();\npreload6(); //lookup4 = gen_lookup('geoip-country.dat', 4);\n//lookup6 = gen_lookup('geoip-country6.dat', 16);","map":{"version":3,"names":["fs","require","net","path","existsSync","utils","fsWatcher","async","watcherName","geodatadir","global","join","__dirname","dataFiles","city","city6","cityNames","country","country6","privateRange4","aton4","conf4","firstIP","lastIP","lastLine","locationBuffer","locationRecordSize","mainBuffer","recordSize","conf6","cache4","JSON","parse","stringify","cache6","RECORD_SIZE","RECORD_SIZE6","lookup4","ip","fline","floor","cline","ceil","line","locId","buffer","locBuffer","privateRange","locRecordSize","i","geodata","range","region","eu","timezone","ll","length","Math","round","readUInt32BE","toString","replace","metro","readInt32BE","area","lookup6","readip","offset","ii","push","cmp6","get4mapped","ipv6","toUpperCase","v6prefixes","v6prefix","indexOf","substring","preload","callback","datFile","datSize","asyncCache","arguments","series","cb","cb2","open","err","file","fstat","stats","size","Buffer","alloc","read","close","code","openSync","fstatSync","readSync","closeSync","preload6","asyncCache6","module","exports","cmp","lookup","isIP","ipv4","aton6","pretty","n","ntoa4","Array","ntoa6","startWatchingDataUpdate","makeFsWatchFilter","stopWatchingDataUpdate","stopWatching","clear","reloadDataSync","reloadData"],"sources":["C:/Users/franc/Documents/React/wearther/node_modules/geoip-lite/lib/geoip.js"],"sourcesContent":["var fs = require('fs');\nvar net = require('net');\nvar path = require('path');\n\nfs.existsSync = fs.existsSync || path.existsSync;\n\nvar utils = require('./utils');\nvar fsWatcher = require('./fsWatcher');\nvar async = require('async');\n\nvar watcherName = 'dataWatcher';\n\n\nvar geodatadir;\n\nif (typeof global.geodatadir === 'undefined'){\n\tgeodatadir = path.join(__dirname, '/../data/');\n} else {\n\tgeodatadir = global.geodatadir;\n}\n\nvar dataFiles = {\n\tcity: path.join(geodatadir, 'geoip-city.dat'),\n\tcity6: path.join(geodatadir, 'geoip-city6.dat'),\n\tcityNames: path.join(geodatadir, 'geoip-city-names.dat'),\n\tcountry: path.join(geodatadir, 'geoip-country.dat'),\n\tcountry6: path.join(geodatadir, 'geoip-country6.dat')\n};\n\nvar privateRange4 = [\n\t[utils.aton4('10.0.0.0'), utils.aton4('10.255.255.255')],\n\t[utils.aton4('172.16.0.0'), utils.aton4('172.31.255.255')],\n\t[utils.aton4('192.168.0.0'), utils.aton4('192.168.255.255')]\n];\n\nvar conf4 = {\n\tfirstIP: null,\n\tlastIP: null,\n\tlastLine: 0,\n\tlocationBuffer: null,\n\tlocationRecordSize: 88,\n\tmainBuffer: null,\n\trecordSize: 24\n};\n\nvar conf6 = {\n\tfirstIP: null,\n\tlastIP: null,\n\tlastLine: 0,\n\tmainBuffer: null,\n\trecordSize: 48\n};\n\n//copy original configs\nvar cache4 = JSON.parse(JSON.stringify(conf4));\nvar cache6 = JSON.parse(JSON.stringify(conf6));\n\nvar RECORD_SIZE = 10;\nvar RECORD_SIZE6 = 34;\n\nfunction lookup4(ip) {\n\tvar fline = 0;\n\tvar floor = cache4.lastIP;\n\tvar cline = cache4.lastLine;\n\tvar ceil = cache4.firstIP;\n\tvar line;\n\tvar locId;\n\n\tvar buffer = cache4.mainBuffer;\n\tvar locBuffer = cache4.locationBuffer;\n\tvar privateRange = privateRange4;\n\tvar recordSize = cache4.recordSize;\n\tvar locRecordSize = cache4.locationRecordSize;\n\n\tvar i;\n\n\tvar geodata = {\n\t\trange: '',\n\t\tcountry: '',\n\t\tregion: '',\n\t\teu:'',\n\t\ttimezone:'',\n\t\tcity: '',\n\t\tll: [0, 0]\n\t};\n\n\t// outside IPv4 range\n\tif (ip > cache4.lastIP || ip < cache4.firstIP) {\n\t\treturn null;\n\t}\n\n\t// private IP\n\tfor (i = 0; i < privateRange.length; i++) {\n\t\tif (ip >= privateRange[i][0] && ip <= privateRange[i][1]) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tdo {\n\t\tline = Math.round((cline - fline) / 2) + fline;\n\t\tfloor = buffer.readUInt32BE(line * recordSize);\n\t\tceil  = buffer.readUInt32BE((line * recordSize) + 4);\n\n\t\tif (floor <= ip && ceil >= ip) {\n\t\t\tgeodata.range = [floor, ceil];\n\n\t\t\tif (recordSize === RECORD_SIZE) {\n\t\t\t\tgeodata.country = buffer.toString('utf8', (line * recordSize) + 8, (line * recordSize) + 10);\n\t\t\t} else {\n\t\t\t\tlocId = buffer.readUInt32BE((line * recordSize) + 8);\n\n\t\t\t\tgeodata.country = locBuffer.toString('utf8', (locId * locRecordSize) + 0, (locId * locRecordSize) + 2).replace(/\\u0000.*/, '');\n\t\t\t\tgeodata.region = locBuffer.toString('utf8', (locId * locRecordSize) + 2, (locId * locRecordSize) + 5).replace(/\\u0000.*/, '');\n\t\t\t\tgeodata.metro = locBuffer.readInt32BE((locId * locRecordSize) + 5);\n\t\t\t\tgeodata.ll[0] = buffer.readInt32BE((line * recordSize) + 12)/10000;//latitude\n\t\t\t\tgeodata.ll[1] = buffer.readInt32BE((line * recordSize) + 16)/10000; //longitude\n\t\t\t\tgeodata.area = buffer.readUInt32BE((line * recordSize) + 20); //longitude\n\t\t\t\tgeodata.eu = locBuffer.toString('utf8', (locId * locRecordSize) + 9, (locId * locRecordSize) + 10).replace(/\\u0000.*/, '');\n\t\t\t\tgeodata.timezone = locBuffer.toString('utf8', (locId * locRecordSize) + 10, (locId * locRecordSize) + 42).replace(/\\u0000.*/, '');\n\t\t\t\tgeodata.city = locBuffer.toString('utf8', (locId * locRecordSize) + 42, (locId * locRecordSize) + locRecordSize).replace(/\\u0000.*/, '');\n\t\t\t}\n\n\t\t\treturn geodata;\n\t\t} else if (fline === cline) {\n\t\t\treturn null;\n\t\t} else if (fline === (cline - 1)) {\n\t\t\tif (line === fline) {\n\t\t\t\tfline = cline;\n\t\t\t} else {\n\t\t\t\tcline = fline;\n\t\t\t}\n\t\t} else if (floor > ip) {\n\t\t\tcline = line;\n\t\t} else if (ceil < ip) {\n\t\t\tfline = line;\n\t\t}\n\t} while(1);\n}\n\nfunction lookup6(ip) {\n\tvar buffer = cache6.mainBuffer;\n\tvar recordSize = cache6.recordSize;\n\tvar locBuffer = cache4.locationBuffer;\n\tvar locRecordSize = cache4.locationRecordSize;\n\n\tvar geodata = {\n\t\trange: '',\n\t\tcountry: '',\n\t\tregion: '',\n\t\tcity: '',\n\t\tll: [0, 0]\n\t};\n\tfunction readip(line, offset) {\n\t\tvar ii = 0;\n\t\tvar ip = [];\n\n\t\tfor (ii = 0; ii < 2; ii++) {\n\t\t\tip.push(buffer.readUInt32BE((line * recordSize) + (offset * 16) + (ii * 4)));\n\t\t}\n\n\t\treturn ip;\n\t}\n\n\tcache6.lastIP = readip(cache6.lastLine, 1);\n\tcache6.firstIP = readip(0, 0);\n\n\tvar fline = 0;\n\tvar floor = cache6.lastIP;\n\tvar cline = cache6.lastLine;\n\tvar ceil = cache6.firstIP;\n\tvar line;\n\tvar locId;\n\n\tif (utils.cmp6(ip, cache6.lastIP) > 0 || utils.cmp6(ip, cache6.firstIP) < 0) {\n\t\treturn null;\n\t}\n\n\tdo {\n\t\tline = Math.round((cline - fline) / 2) + fline;\n\t\tfloor = readip(line, 0);\n\t\tceil  = readip(line, 1);\n\n\t\tif (utils.cmp6(floor, ip) <= 0 && utils.cmp6(ceil, ip) >= 0) {\n\t\t\tif (recordSize === RECORD_SIZE6) {\n\t\t\t\tgeodata.country = buffer.toString('utf8', (line * recordSize) + 32, (line * recordSize) + 34).replace(/\\u0000.*/, '');\n\t\t\t} else {\n\t\t\t\tlocId = buffer.readUInt32BE((line * recordSize) + 32);\n\n\t\t\t\tgeodata.country = locBuffer.toString('utf8', (locId * locRecordSize) + 0, (locId * locRecordSize) + 2).replace(/\\u0000.*/, '');\n\t\t\t\tgeodata.region = locBuffer.toString('utf8', (locId * locRecordSize) + 2, (locId * locRecordSize) + 5).replace(/\\u0000.*/, '');\n\t\t\t\tgeodata.metro = locBuffer.readInt32BE((locId * locRecordSize) + 5);\n\t\t\t\tgeodata.ll[0] = buffer.readInt32BE((line * recordSize) + 36)/10000;//latitude\n\t\t\t\tgeodata.ll[1] = buffer.readInt32BE((line * recordSize) + 40)/10000; //longitude\n\t\t\t\tgeodata.area = buffer.readUInt32BE((line * recordSize) + 44); //area\n\t\t\t\tgeodata.eu = locBuffer.toString('utf8', (locId * locRecordSize) + 9, (locId * locRecordSize) + 10).replace(/\\u0000.*/, '');\n\t\t\t\tgeodata.timezone = locBuffer.toString('utf8', (locId * locRecordSize) + 10, (locId * locRecordSize) + 42).replace(/\\u0000.*/, '');\n\t\t\t\tgeodata.city = locBuffer.toString('utf8', (locId * locRecordSize) + 42, (locId * locRecordSize) + locRecordSize).replace(/\\u0000.*/, '');\n\t\t\t}\n\t\t\t// We do not currently have detailed region/city info for IPv6, but finally have coords\n\t\t\treturn geodata;\n\t\t} else if (fline === cline) {\n\t\t\treturn null;\n\t\t} else if (fline === (cline - 1)) {\n\t\t\tif (line === fline) {\n\t\t\t\tfline = cline;\n\t\t\t} else {\n\t\t\t\tcline = fline;\n\t\t\t}\n\t\t} else if (utils.cmp6(floor, ip) > 0) {\n\t\t\tcline = line;\n\t\t} else if (utils.cmp6(ceil, ip) < 0) {\n\t\t\tfline = line;\n\t\t}\n\t} while(1);\n}\n\nfunction get4mapped(ip) {\n\tvar ipv6 = ip.toUpperCase();\n\tvar v6prefixes = ['0:0:0:0:0:FFFF:', '::FFFF:'];\n\tfor (var i = 0; i < v6prefixes.length; i++) {\n\t\tvar v6prefix = v6prefixes[i];\n\t\tif (ipv6.indexOf(v6prefix) == 0) {\n\t\t\treturn ipv6.substring(v6prefix.length);\n\t\t}\n\t}\n\treturn null;\n}\n\nfunction preload(callback) {\n\tvar datFile;\n\tvar datSize;\n\tvar asyncCache = JSON.parse(JSON.stringify(conf4));\n\n\t//when the preload function receives a callback, do the task asynchronously\n\tif (typeof arguments[0] === 'function') {\n\t\tasync.series([\n\t\t\tfunction (cb) {\n\t\t\t\tasync.series([\n\t\t\t\t\tfunction (cb2) {\n\t\t\t\t\t\tfs.open(dataFiles.cityNames, 'r', function (err, file) {\n\t\t\t\t\t\t\tdatFile = file;\n\t\t\t\t\t\t\tcb2(err);\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tfunction (cb2) {\n\t\t\t\t\t\tfs.fstat(datFile, function (err, stats) {\n\t\t\t\t\t\t\tdatSize = stats.size;\n\t\t\t\t\t\t\tasyncCache.locationBuffer = Buffer.alloc(datSize);\n\t\t\t\t\t\t\tcb2(err);\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tfunction (cb2) {\n\t\t\t\t\t\tfs.read(datFile, asyncCache.locationBuffer, 0, datSize, 0, cb2);\n\t\t\t\t\t},\n\t\t\t\t\tfunction (cb2) {\n\t\t\t\t\t\tfs.close(datFile, cb2);\n\t\t\t\t\t},\n\t\t\t\t\tfunction (cb2) {\n\t\t\t\t\t\tfs.open(dataFiles.city, 'r', function (err, file) {\n\t\t\t\t\t\t\tdatFile = file;\n\t\t\t\t\t\t\tcb2(err);\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tfunction (cb2) {\n\t\t\t\t\t\tfs.fstat(datFile, function (err, stats) {\n\t\t\t\t\t\t\tdatSize = stats.size;\n\t\t\t\t\t\t\tcb2(err);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t], function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tif (err.code !== 'ENOENT' && err.code !== 'EBADF') {\n\t\t\t\t\t\t\tthrow err;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfs.open(dataFiles.country, 'r', function (err, file) {\n\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\tcb(err);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdatFile = file;\n\t\t\t\t\t\t\t\tfs.fstat(datFile, function (err, stats) {\n\t\t\t\t\t\t\t\t\tdatSize = stats.size;\n\t\t\t\t\t\t\t\t\tasyncCache.recordSize = RECORD_SIZE;\n\n\t\t\t\t\t\t\t\t\tcb();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcb();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tfunction () {\n\t\t\t\tasyncCache.mainBuffer = Buffer.alloc(datSize);\n\t\t\t\t\n\t\t\t\tasync.series([\n\t\t\t\t\tfunction (cb2) {\n\t\t\t\t\t\tfs.read(datFile, asyncCache.mainBuffer, 0, datSize, 0, cb2);\n\t\t\t\t\t},\n\t\t\t\t\tfunction (cb2) {\n\t\t\t\t\t\tfs.close(datFile, cb2);\n\t\t\t\t\t}\n\t\t\t\t], function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\t//keep old cache\n\t\t\t\t\t} else {\n\t\t\t\t\t\tasyncCache.lastLine = (datSize / asyncCache.recordSize) - 1;\n\t\t\t\t\t\tasyncCache.lastIP = asyncCache.mainBuffer.readUInt32BE((asyncCache.lastLine * asyncCache.recordSize) + 4);\n\t\t\t\t\t\tasyncCache.firstIP = asyncCache.mainBuffer.readUInt32BE(0);\n\t\t\t\t\t\tcache4 = asyncCache;\n\t\t\t\t\t}\n\t\t\t\t\tcallback(err);\n\t\t\t\t});\n\t\t\t}\n\t\t]);\n\t} else {\n\t\ttry {\n\t\t\tdatFile = fs.openSync(dataFiles.cityNames, 'r');\n\t\t\tdatSize = fs.fstatSync(datFile).size;\n\n\t\t\tif (datSize === 0) {\n\t\t\t\tthrow {\n\t\t\t\t\tcode: 'EMPTY_FILE'\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tcache4.locationBuffer = Buffer.alloc(datSize);\n\t\t\tfs.readSync(datFile, cache4.locationBuffer, 0, datSize, 0);\n\t\t\tfs.closeSync(datFile);\n\n\t\t\tdatFile = fs.openSync(dataFiles.city, 'r');\n\t\t\tdatSize = fs.fstatSync(datFile).size;\n\t\t} catch(err) {\n\t\t\tif (err.code !== 'ENOENT' && err.code !== 'EBADF' && err.code !== 'EMPTY_FILE') {\n\t\t\t\tthrow err;\n\t\t\t}\n\n\t\t\tdatFile = fs.openSync(dataFiles.country, 'r');\n\t\t\tdatSize = fs.fstatSync(datFile).size;\n\t\t\tcache4.recordSize = RECORD_SIZE;\n\t\t}\n\n\t\tcache4.mainBuffer = Buffer.alloc(datSize);\n\t\tfs.readSync(datFile, cache4.mainBuffer, 0, datSize, 0);\n\n\t\tfs.closeSync(datFile);\n\n\t\tcache4.lastLine = (datSize / cache4.recordSize) - 1;\n\t\tcache4.lastIP = cache4.mainBuffer.readUInt32BE((cache4.lastLine * cache4.recordSize) + 4);\n\t\tcache4.firstIP = cache4.mainBuffer.readUInt32BE(0);\n\t}\n}\n\nfunction preload6(callback) {\n\tvar datFile;\n\tvar datSize;\n\tvar asyncCache6 = JSON.parse(JSON.stringify(conf6));\n\n\t//when the preload function receives a callback, do the task asynchronously\n\tif (typeof arguments[0] === 'function') {\n\t\tasync.series([\n\t\t\tfunction (cb) {\n\t\t\t\tasync.series([\n\t\t\t\t\tfunction (cb2) {\n\t\t\t\t\t\tfs.open(dataFiles.city6, 'r', function (err, file) {\n\t\t\t\t\t\t\tdatFile = file;\n\t\t\t\t\t\t\tcb2(err);\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tfunction (cb2) {\n\t\t\t\t\t\tfs.fstat(datFile, function (err, stats) {\n\t\t\t\t\t\t\tdatSize = stats.size;\n\t\t\t\t\t\t\tcb2(err);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t], function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tif (err.code !== 'ENOENT' && err.code !== 'EBADF') {\n\t\t\t\t\t\t\tthrow err;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfs.open(dataFiles.country6, 'r', function (err, file) {\n\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\tcb(err);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdatFile = file;\n\t\t\t\t\t\t\t\tfs.fstat(datFile, function (err, stats) {\n\t\t\t\t\t\t\t\t\tdatSize = stats.size;\n\t\t\t\t\t\t\t\t\tasyncCache6.recordSize = RECORD_SIZE6;\n\n\t\t\t\t\t\t\t\t\tcb();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcb();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tfunction () {\n\t\t\t\tasyncCache6.mainBuffer = Buffer.alloc(datSize);\n\t\t\t\t\n\t\t\t\tasync.series([\n\t\t\t\t\tfunction (cb2) {\n\t\t\t\t\t\tfs.read(datFile, asyncCache6.mainBuffer, 0, datSize, 0, cb2);\n\t\t\t\t\t},\n\t\t\t\t\tfunction (cb2) {\n\t\t\t\t\t\tfs.close(datFile, cb2);\n\t\t\t\t\t}\n\t\t\t\t], function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\t//keep old cache\n\t\t\t\t\t} else {\n\t\t\t\t\t\tasyncCache6.lastLine = (datSize / asyncCache6.recordSize) - 1;\n\t\t\t\t\t\tcache6 = asyncCache6;\n\t\t\t\t\t}\n\t\t\t\t\tcallback(err);\n\t\t\t\t});\n\t\t\t}\n\t\t]);\n\t} else {\n\t\ttry {\n\t\t\tdatFile = fs.openSync(dataFiles.city6, 'r');\n\t\t\tdatSize = fs.fstatSync(datFile).size;\n\n\t\t\tif (datSize === 0) {\n\t\t\t\tthrow {\n\t\t\t\t\tcode: 'EMPTY_FILE'\n\t\t\t\t};\n\t\t\t}\n\t\t} catch(err) {\n\t\t\tif (err.code !== 'ENOENT' && err.code !== 'EBADF' && err.code !== 'EMPTY_FILE') {\n\t\t\t\tthrow err;\n\t\t\t}\n\n\t\t\tdatFile = fs.openSync(dataFiles.country6, 'r');\n\t\t\tdatSize = fs.fstatSync(datFile).size;\n\t\t\tcache6.recordSize = RECORD_SIZE6;\n\t\t}\n\n\t\tcache6.mainBuffer = Buffer.alloc(datSize);\n\t\tfs.readSync(datFile, cache6.mainBuffer, 0, datSize, 0);\n\n\t\tfs.closeSync(datFile);\n\n\t\tcache6.lastLine = (datSize / cache6.recordSize) - 1;\n\t}\n}\n\nmodule.exports = {\n\tcmp: utils.cmp,\n\n\tlookup: function(ip) {\n\t\tif (!ip) {\n\t\t\treturn null;\n\t\t} else if (typeof ip === 'number') {\n\t\t\treturn lookup4(ip);\n\t\t} else if (net.isIP(ip) === 4) {\n\t\t\treturn lookup4(utils.aton4(ip));\n\t\t} else if (net.isIP(ip) === 6) {\n\t\t\tvar ipv4 = get4mapped(ip);\n\t\t\tif (ipv4) {\n\t\t\t\treturn lookup4(utils.aton4(ipv4));\n\t\t\t} else {\n\t\t\t\treturn lookup6(utils.aton6(ip));\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t},\n\n\tpretty: function(n) {\n\t\tif (typeof n === 'string') {\n\t\t\treturn n;\n\t\t} else if (typeof n === 'number') {\n\t\t\treturn utils.ntoa4(n);\n\t\t} else if (n instanceof Array) {\n\t\t\treturn utils.ntoa6(n);\n\t\t}\n\n\t\treturn n;\n\t},\n\n\t// Start watching for data updates. The watcher waits one minute for file transfer to \n\t// completete before triggering the callback.\n\tstartWatchingDataUpdate: function (callback) {\n\t\tfsWatcher.makeFsWatchFilter(watcherName, geodatadir, 60*1000, function () {\n\t\t\t//Reload data\n\t\t\tasync.series([\n\t\t\t\tfunction (cb) {\n\t\t\t\t\tpreload(cb);\n\t\t\t\t},\n\t\t\t\tfunction (cb) {\n\t\t\t\t\tpreload6(cb);\n\t\t\t\t}\n\t\t\t], callback);\n\t\t});\n\t},\n\n\t// Stop watching for data updates.\n\tstopWatchingDataUpdate: function () {\n\t\tfsWatcher.stopWatching(watcherName);\n\t},\n    \n\t//clear data\n\tclear: function () {\n\t\tcache4 = JSON.parse(JSON.stringify(conf4));\n\t\tcache6 = JSON.parse(JSON.stringify(conf6));\n\t},\n\t\n\t// Reload data synchronously\n\treloadDataSync: function () {\n\t\tpreload();\n\t\tpreload6();\n\t},\n\t\n\t// Reload data asynchronously\n\treloadData: function (callback) {\n\t\t//Reload data\n\t\tasync.series([\n\t\t\tfunction (cb) {\n\t\t\t\tpreload(cb);\n\t\t\t},\n\t\t\tfunction (cb) {\n\t\t\t\tpreload6(cb);\n\t\t\t}\n\t\t], callback);\n\t},\n};\n\npreload();\npreload6();\n\n//lookup4 = gen_lookup('geoip-country.dat', 4);\n//lookup6 = gen_lookup('geoip-country6.dat', 16);\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}